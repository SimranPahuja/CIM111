self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SharePointLink.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[452],{1103:function(e){e.exports={b:"ida",d:"jda",c:"kda",a:"lda"}},1690:function(e,t,n){"use strict";var r=n(4),c=Object(r.createStore)("bposStore",{bposNavBarData:null})();t.a=c},1929:function(e,t,n){"use strict";var r=n(1690),c=n(4),a=Object(c.action)("SET_BPOS_NAV_BAR_DATA ",function(e){return{bposNavBarData:e}});Object(c.mutator)(a,function(e){r.a.bposNavBarData=e.bposNavBarData});var o=n(2322),i=n.n(o);var u=n(2214),s=n(71),f=Object(c.action)("LOAD_BposNavBarData"),d=f;function l(){return r.a.bposNavBarData}Object(c.orchestrator)(f,function(e){Object(s.s)()||i()().then(function(e){a(e),Object(u.a)()})}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return l})},2143:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},2214:function(e,t,n){"use strict";var r=n(4);t.a=Object(r.action)("ON_BPOS_NAV_BAR_DATA_LOADED")},2322:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129);t.default=function(e){return r.makeServiceRequest("GetBposShellInfoNavBarData",{},e)}},2782:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),c=n(2143);t.default=function(e,t){return void 0===e||e.__type||(e=c.default(e)),r.makeServiceRequest("FetchDataProviderResource",e,t)}},3246:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(0),c=n(151),a=n(65),o=n(2143),i=n.n(o),u=n(2782),s=n.n(u),f=n(62);function d(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,function(){var u,d,l,p,b,O,v,h,j,m,w,S;return Object(r.__generator)(this,function(r){switch(r.label){case 0:u=new c.a("getWacInfoForOneDriveJsApi"),o&&u.addCustomData({redeemSharingLinkIfNecessary:o}),r.label=1;case 1:return r.trys.push([1,3,,4]),d=btoa(t),l="u!"+d.replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),p=new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0],Object(a.f)("doc-SxS-jsApi-ODB-Readonly")&&(n=!1),b=p+"_api/v2.0/shares/"+l+"/root?select=openWith/wac,officeBundle,@content.downloadUrl,name,size,currentUserRole&action="+(n?"Open":"View"),O=new Object,o&&(O.prefer="redeemSharingLinkIfNecessary"),v=i()({ProviderType:e,Url:b,Headers:JSON.stringify(O)}),h=(new Date).getTime(),[4,s()(v)];case 2:if(200===(j=r.sent()).Status&&j.Body)return m=(new Date).getTime(),(w=JSON.parse(j.Body)).fetchStartTime=h,w.responseStartTime=m,w.openWith.wac.fileGetUrl=w["@content.downloadUrl"],w.openWith.wac.accessTokenExpiry&&(w.openWith.wac.accessTokenExpiry=new Date(Number(w.openWith.wac.accessTokenExpiry))),!n&&w.currentUserRole&&(w.currentUserRole.readOnly=!0),u.end(),[2,w];throw u.addCustomData({StatusCode:j.Status}),new Error("Result status is: "+j.Status+" or empty response body.");case 3:return S=r.sent(),u.endWithError("ServerError",S),f.d.warn("Something went wrong while calling fetchDataProviderResourceOperation: "+S),[3,4];case 4:return[2,null]}})})}},3270:function(e,t,n){"use strict";n.d(t,"h",function(){return r}),n.d(t,"i",function(){return c}),n.d(t,"e",function(){return a}),n.d(t,"f",function(){return o}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return u}),n.d(t,"a",function(){return s}),n.d(t,"c",function(){return f}),n.d(t,"g",function(){return d});var r=108e6,c=2,a="SP_LINK_CLICK_EVENT_LISTENER",o="SP_LINK_MOUSEUP_EVENT_LISTENER",i="originalsrc",u="shash",s="data-auth",f="&reserved=0",d="Verified"},3370:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(3543),c=n.n(r);function a(e,t,n,r,a){return void 0===n&&(n=!1),void 0===r&&(r=!1),c()({request:{Url:e,IsEdit:r,ProviderType:t,ShouldGrantAccess:n}},a)}},3412:function(e,t,n){"use strict";var r=n(151),c=n(248);function a(e,t){var n;try{n=Object(c.parse)(e).hostname}catch(e){return Object(r.m)("isLinkPrefixedWithBaseUrl"),!1}return n===Object(c.parse)(t).hostname&&e!==t}var o=n(1929),i=n(65),u=n(62),s=["https://microsoft.sharepoint.com","https://microsoft-my.sharepoint.com","https://microsoft.sharepoint-df.com","https://microsoft-my.sharepoint-df.com"];function f(e){if(!e)return Object(r.m)("isSharePointLinkCalledWithoutUrl"),!1;var t=Object(o.a)();return t?!(!t.SPO_MySiteHostUrl||!a(e,t.SPO_MySiteHostUrl))||(!(!t.SPO_RootSiteUrl||!a(e,t.SPO_RootSiteUrl))||!!Object(i.f)("doc-SharePoint-dogfoodUser")&&s.some(function(t){return a(e,t)})):(u.d.info("isSharePointLink:bposNavBarData is null"),!1)}function d(e){return!!e&&(e.indexOf("?at=")>0||e.indexOf("&at=")>0)}n.d(t,"a",function(){return a}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return d})},3543:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),c=n(3544);t.default=function(e,t){return void 0===e.request||e.request.__type||(e.request=c.default(e.request)),r.makeServiceRequest("GetWacInfo",e,t)}},3544:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetWacInfoRequest:#Exchange"},e)}},3755:function(e,t,n){"use strict";n.d(t,"h",function(){return c}),n.d(t,"g",function(){return a}),n.d(t,"e",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return u}),n.d(t,"b",function(){return s}),n.d(t,"f",function(){return f}),n.d(t,"c",function(){return d});var r=n(4),c=Object(r.action)("tryQueueGetWacInfo",function(e){return{url:e}}),a=Object(r.action)("queueGetWacInfo",function(e){return{url:e}}),o=Object(r.action)("processGetWacInfoQueue"),i=Object(r.action)("getWacInfoQueueShift"),u=Object(r.action)("onStartGetWacInfoOperation",function(e){return{url:e}}),s=Object(r.action)("onFinishGetWacInfoOperation",function(e){return{url:e}}),f=Object(r.action)("pushSupressedUrl",function(e){return{url:e}}),d=Object(r.action)("onGetWacInfoSuccess",function(e,t){return{url:e,wacUrlInfo:t}})},3756:function(e,t,n){"use strict";var r=n(21),c=n(4),a={activeGetWacInfoOperations:[],getWacInfoQueue:[],suppressedUrls:[],docLinkPreviewInfoMap:new r.ObservableMap},o=Object(c.createStore)("sharePointDocLinkPreview",a);t.a=o()},3998:function(e,t,n){"use strict";n.r(t);var r=n(3755),c=n(3756),a=n(4);Object(a.mutator)(r.d,function(e){var t=e.url;c.a.activeGetWacInfoOperations.push(t)}),Object(a.mutator)(r.b,function(e){var t=e.url;c.a.activeGetWacInfoOperations.splice(c.a.activeGetWacInfoOperations.indexOf(t),1)}),Object(a.mutator)(r.c,function(e){var t=e.url,n=e.wacUrlInfo,r={time:Date.now(),wacUrlInfo:n};c.a.docLinkPreviewInfoMap.set(t,r)}),Object(a.mutator)(r.g,function(e){var t=e.url;c.a.getWacInfoQueue.push(t)}),Object(a.mutator)(r.a,function(){c.a.getWacInfoQueue.shift()}),Object(a.mutator)(r.f,function(e){var t=e.url;c.a.suppressedUrls.push(t)});var o=n(1785),i=n(3270),u=n(7293),s=n(7294);Object(a.orchestrator)(o.a,function(e){var t=e.element;t.addEventListener("click",s.a),t[i.e]=s.a,t.addEventListener("mouseup",u.a),t[i.f]=u.a});var f=n(0),d=n(3370),l=n(3246),p=n(65),b=n(762),O=n(4995);function v(e,t){return Object(f.__awaiter)(this,void 0,void 0,function(){var n,c,a,o;return Object(f.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,,9,10]),Object(r.d)(e),n=null,Object(p.f)("doc-SxS-jsApi-ODB-Links")?[4,Object(l.a)(0,e,!0)]:[3,6];case 1:return(c=i.sent())?[3,2]:(Object(r.f)(e),[2,null]);case 2:return a=Object(b.b)(c.name),(o=Object(b.e)(a))!==b.a.Word&&o!==b.a.Excel&&o!==b.a.PowerPoint?[3,3]:(n={wacUrl:c.openWith.wac.applicationUrl,jsApiInfo:{bootScriptUrl:c.openWith.wac.bootstrapperUrl,wopiSrcUrl:c.openWith.wac.wopiSrc,accessToken:c.openWith.wac.accessToken,accessTokenExpiry:c.openWith.wac.accessTokenExpiry,fileSize:c.size,fileGetUrl:c.openWith.wac.fileGetUrl,bundleInfo:c.officeBundle,fetchStartTime:c.fetchStartTime,responseStartTime:c.responseStartTime,openUrl:e,fileName:c.name},readOnly:c.currentUserRole.readOnly},[3,5]);case 3:return[4,h(e)];case 4:n=i.sent(),i.label=5;case 5:return[3,8];case 6:return[4,h(e)];case 7:n=i.sent(),i.label=8;case 8:return n&&Object(r.c)(e,n),t?[2,Object(O.a)(e)]:[2,null];case 9:return Object(r.b)(e),[7];case 10:return[2]}})})}function h(e){return Object(f.__awaiter)(this,void 0,void 0,function(){var t;return Object(f.__generator)(this,function(n){switch(n.label){case 0:return[4,Object(d.a)(e,0)];case 1:if(9===(t=n.sent()).Status||6===t.Status||5===t.Status)Object(r.f)(e);else if(0===t.Status)return[2,{wacUrl:t.WacUrl,bootScriptUrl:t.BootScriptUrl,wopiSrcUrl:t.WopiSrcUrl,accessToken:t.AccessToken,token:t.Token}];return[2,null]}})})}Object(a.orchestrator)(r.e,function(){return Object(f.__awaiter)(void 0,void 0,void 0,function(){var e;return Object(f.__generator)(this,function(t){switch(t.label){case 0:if(!c.a.getWacInfoQueue.length)return[2];if(c.a.activeGetWacInfoOperations.length>=i.i)return[2];e=c.a.getWacInfoQueue[0],Object(r.d)(e),Object(r.a)(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,v(e,!1)];case 2:return t.sent(),[3,4];case 3:return Object(r.b)(e),Object(r.e)(),[7];case 4:return[2]}})})});var j=n(151),m=n(3412),w=n(5578);Object(a.orchestrator)(o.d,function(e){var t=e.element,n=e.itemId;if("a"===t.tagName.toLowerCase()){var r=t;if(Object(w.a)(r)){var c=t.getAttribute(i.b);Object(m.b)(c)&&(Object(m.c)(c)?Object(p.f)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(o.a)(t):Object(p.f)("doc-SxS-jsApi-ODB-Links")&&t.getAttribute(i.a)===i.g?Object(o.b)(t,c,n):Object(p.f)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(o.a)(t),g())}else{c=r.href;Object(m.b)(c)&&(Object(m.c)(c)?Object(p.f)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(o.a)(t):Object(p.f)("doc-SxS-jsApi-ODB-Links")?Object(o.b)(t,c,n):Object(p.f)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(o.a)(t),g())}}});var S=!1;function g(){S||(S=!0,Object(j.m)("SharePointLinkFound"))}function _(e){var t=c.a.docLinkPreviewInfoMap.get(e),n=!!t;return(!t||t.time+i.h<=Date.now())&&Object(r.h)(e),n}Object(a.orchestrator)(r.h,function(e){var t=e.url;c.a.getWacInfoQueue.some(function(e){return e===t})||c.a.activeGetWacInfoOperations.some(function(e){return e===t})||c.a.suppressedUrls.some(function(e){return e===t})||Object(O.a)(t)||(Object(r.g)(t),Object(r.e)())}),Object(a.orchestrator)(o.e,function(e){var t=e.elements;t&&t.forEach(function(e){var t=e[i.e];t&&(e.removeEventListener("click",t),e[i.e]=null);var n=e[i.f];n&&(e.removeEventListener("mouseup",n),e[i.f]=null)})}),n.d(t,"tryProcessSharePointLink",function(){return o.d}),n.d(t,"tryUndoProcessSharePointLink",function(){return o.e}),n.d(t,"docLinkHadPreviewInfo",function(){return _}),n.d(t,"forceGetWacInfoOperation",function(){return v}),n.d(t,"getValidDocLinkPreviewInfo",function(){return O.a})},4994:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(151);function c(e){Object(r.m)("SharePointLinkClick",{newTabReason:e})}},4995:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o});var r=n(3270),c=n(3756);function a(e){return o(e).docLinkPreviewInfo||null}function o(e){var t=c.a.docLinkPreviewInfoMap.get(e);return t?t.time+r.h>Date.now()?{docLinkPreviewInfo:t}:{reason:"Expired"}:c.a.getWacInfoQueue.some(function(t){return t===e})||c.a.activeGetWacInfoOperations.some(function(t){return t===e})?{reason:"InQueue"}:c.a.suppressedUrls.some(function(t){return t===e})?{reason:"FileTypeNotSupportedOrSuppressedAfterError"}:{reason:"Unknown"}}},5578:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(3270);function c(e){return e.hasAttribute(r.b)&&e.hasAttribute(r.d)&&e.hasAttribute(r.a)}},7293:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(4994),c=1,a=2;function o(e){e.button===c?Object(r.a)("MouseMiddleButton"):e.button===a&&Object(r.a)("MouseRightButton")}},7294:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(151),c=n(319),a=n(3270),o=n(5578),i=n(4994);function u(e,t){var n,u,s=Date.now(),f=new r.a("ServiceGeneratedLinkClickHandler"),d="CT="+s+"&OR=OWA-"+(e?e.ctrlKey||1===e.button?"NTB":e.shiftKey?"NW":"NT":"NT")+"&CID="+Object(c.a)(),l=e.currentTarget,p=(u=new URL(l.href),["CID","OR","CT"].forEach(function(e){u.searchParams.get(e)&&u.searchParams.delete(e)}),u);if(Object(o.a)(l)){var b=p.href,O=b.indexOf(a.c);if(-1===O)return;var v=encodeURIComponent(btoa(d));n=b.substr(0,O)+"&xdata="+v+a.c}else{var h=p.href.indexOf("?")>=0?"&":"?";n=p.href+h+d}f.end(),window.open(n),e.preventDefault(),Object(i.a)(t||(e.altKey?"AltKey":e.ctrlKey?"CtrlKey":e.metaKey?"MetaKey":e.shiftKey?"ShiftKey":"Default"))}},762:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function c(e){var t=r(e);return t?t.replace(".",""):null}function a(e){var t;return null===(t=c(e))||void 0===t?void 0:t.substring(0,4)}var o=n(1103),i=n(5);function u(e){var t;return e>=1073741824?(e/=1073741824,t=Object(i.a)(o.b)):e>=1048576?(e/=1048576,t=Object(i.a)(o.d)):e>=1024?(e/=1024,t=Object(i.a)(o.c)):t=Object(i.a)(o.a),Object(i.b)(t,Math.round(e))}function s(e){return e&&(t=e,(n=d.exec(t))&&n.length>1&&f[n[1].toLowerCase()]);var t,n}var f={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},d=/^\s*([^;\s]*)(?:;|\s|$)/;var l=n(25),p=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],b=[".tiff",".tif"];function O(e,t,n){void 0===n&&(n=!0);var c=r(e)||s(t);return!!c&&(p.indexOf(c.toLowerCase())>=0||n&&b.indexOf(c.toLowerCase())>=0&&(Object(l.d)()||Object(l.c)()||Object(l.g)()||Object(l.f)()&&!Object(l.i)()))}var v,h=n(65),j=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function m(e){if(!Object(h.f)("doc-attachment-documentThumbnail"))return!1;var t=r(e);return!!t&&j.indexOf(t.toLowerCase())>=0}function w(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return v.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return v.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return v.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(v||(v={})),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return c}),n.d(t,"d",function(){return a}),n.d(t,"h",function(){return u}),n.d(t,"f",function(){return O}),n.d(t,"g",function(){return m}),n.d(t,"e",function(){return w}),n.d(t,"a",function(){return v})}}]);
//# sourceMappingURL=owa.SharePointLink.js.map
self.scriptsLoaded['owa.SharePointLink.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SharePointLink.js'] = (new Date()).getTime();