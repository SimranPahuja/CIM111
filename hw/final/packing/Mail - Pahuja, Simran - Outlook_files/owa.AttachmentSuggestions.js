self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.AttachmentSuggestions.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[130],{1103:function(e){e.exports={b:"ida",d:"jda",c:"kda",a:"lda"}},1292:function(e,t,n){"use strict";var r=n(4),o=n(21),i=n(1603),a={providers:new o.ObservableMap,loadState:i.a.NotLoaded,removalPending:new o.ObservableMap},u=Object(r.createStore)("fileProviderStoreV2",a);t.a=u},1327:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a});var r=n(4),o=Object(r.action)("FILE_PROVIDER_ADDED",function(e){return{providerViewState:e}}),i=Object(r.action)("FILE_PROVIDER_REMOVED",function(e){return{providerType:e}}),a=Object(r.action)("PROVIDERS_LOADED",function(e){return{providers:e}})},1388:function(e,t,n){"use strict";var r=n(0),o=n(2650),i=n.n(o),a=n(1995),u=n.n(a);function c(e){var t=u()({ProviderType:e});return i()(t)}var s=n(2651),l=n.n(s),d=n(1996),f=n.n(d);function h(e){var t=f()({ProviderType:e});return l()(t)}var p=n(2520),m=n(65);n.d(t,"a",function(){return _}),n.d(t,"b",function(){return P});var v="code",b="token",g=3e3,O=3;function y(e){return{state:e}}function j(e){return e.state}function S(e){return e.code}function _(e,t,n,o,i){var a={providerType:e,getAuthUrlInfo:null,getCSRFToken:j,getOAuthCode:S};return function e(t,n,o,i,a,u,s){return Object(r.__awaiter)(this,void 0,void 0,function(){var l,d;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),l=void 0,7!==t&&9!==t&&8!==t?[3,2]:[4,h(t)];case 1:return d=r.sent(),l=d.AttachmentDataProviderCreator.ProviderAppKey,o=d.AttachmentDataProviderCreator.AuthorizationUri,[3,4];case 2:return[4,c(t)];case 3:d=r.sent(),l=d.ProviderAppKey,r.label=4;case 4:return n.getAuthUrlInfo=Object(p.d)(t,o,i,l,a,u),[3,6];case 5:return r.sent(),s>0&&setTimeout(function(){return e(t,n,o,i,a,u,--s)},g),[3,6];case 6:return[2]}})})}(e,a,t,n,o,i,O),a}var I=null;function w(){if(!I){(I={})[3]=_(3,"https://app.box.com/api/oauth2/authorize",Object(p.c)(3),v,y),I[2]=_(2,"https://www.dropbox.com/oauth2/authorize",Object(p.b)(2),v,y);var e=_(6,"https://www.facebook.com/dialog/oauth",Object(p.b)(6),b,function(e){return{state:e,scope:"user_photos,email"}});e.getCSRFToken=j,e.getOAuthCode=function(e){return e.access_token},I[6]=e;var t=_(5,"https://accounts.google.com/o/oauth2/auth",p.a+"/ADPRedirect.aspx",v,function(e){var t={state:e,provider:5..toString(),url:Object(p.b)()};return{state:JSON.stringify(t),scope:"https://www.googleapis.com/auth/drive",access_type:"offline",prompt:"consent",include_granted_scopes:"true"}});t.getCSRFToken=function(e){return JSON.parse(e.state).state},I[5]=t,I[1]=_(1,"https://login.live.com/oauth20_authorize.srf",Object(p.c)(1),v,function(e){return{state:e,scope:"wl.basic onedrive.readwrite wl.offline_access"}}),Object(m.f)("doc-fileProvider-wopiClient")&&(I[7]=_(7,"",Object(p.c)(7),v,y),I[8]=_(8,"",Object(p.c)(8),v,y),I[9]=_(9,"",Object(p.c)(9),v,y))}return I}function P(e){var t=w();return e in t?t[e]:null}},1417:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return a});var r=n(0),o=n(1292),i=function(){return Object(r.__spread)(Object(o.a)().providers.values())},a=function(e){return Object(o.a)().providers.get(e)||null}},1510:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return i}),n.d(t,"c",function(){return a});var r,o=n(0);!function(e){e[e.Groups=1e4]="Groups"}(r||(r={}));var i=Object.freeze([1,3,2,6,5,7,8,9]),a=Object.freeze(Object(o.__spread)(i,[0,4,10]))},1552:function(e,t,n){"use strict";var r=n(52),o=n(1919),i=n(1788),a=(n(1292),n(1327)),u=n(1510),c=(n(2471),n(2406),n(1417));var s=n(1769),l=n(1603),d=n(1388);n.d(t,"k",function(){return h}),n.d(t,"m",function(){return p}),n.d(t,"j",function(){return m}),n.d(t,"l",function(){return v}),n.d(t,"b",function(){return o.a}),n.d(t,"h",function(){return i.a}),n.d(t,"d",function(){return a.a}),n.d(t,"e",function(){return a.b}),n.d(t,"n",function(){return a.c}),n.d(t,"a",function(){return u.b}),n.d(t,"g",function(){return c.b}),n.d(t,"i",function(){return s.a}),n.d(t,"c",function(){return l.a}),n.d(t,"f",function(){return d.b});var f=new r.c(function(){return Promise.all([n.e(589),n.e(4),n.e(12),n.e(21),n.e(243)]).then(n.bind(null,14138))}),h=new r.b(f,function(e){return e.loadProviders}),p=new r.b(f,function(e){return e.removeFileProvider}),m=new r.b(f,function(e){return e.addFileProvider}),v=new r.b(f,function(e){return e.removeAndAddFileProvider})},1603:function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e[e.Loaded=0]="Loaded",e[e.Loading=1]="Loading",e[e.NotLoaded=2]="NotLoaded"}(r||(r={}))},161:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,o=!1;function i(t){r--,delete e[t]}this.put=function(t,n,o,a){if(void 0!==o&&("number"!=typeof o||isNaN(o)||o<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==a&&"function"!=typeof a)throw new Error("Cache timeout callback must be a function");var u=e[t];u?clearTimeout(u.timeout):r++;var c={value:n,expire:o+Date.now()};return isNaN(c.expire)||(c.timeout=setTimeout(function(){i(t),a&&a(t,n)}.bind(this),o)),e[t]=c,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&i(t),n},this.clear=function(){for(var i in e)clearTimeout(e[i].timeout);r=0,e=Object.create(null),o&&(t=0,n=0)},this.get=function(i){var a=e[i];if(void 0!==a){if(isNaN(a.expire)||a.expire>=Date.now())return o&&t++,a.value;o&&n++,r--,delete e[i]}else o&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){o=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),o=Date.now(),i=n&&n.skipDuplicates;for(var a in r)if(r.hasOwnProperty(a)){if(i)if(e[a])continue;var u=r[a],c=u.expire-o;if(c<=0){this.del(a);continue}c=c>0?c:void 0,this.put(a,u.value,c)}return this.size()}}e.exports=new r,e.exports.Cache=r},1769:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(1292);function o(){return Object(r.a)().loadState}},1788:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(2649),o=n(2405),i=n(2569),a=n(5),u=n(160);function c(e,t){if(void 0===t&&(t=!1),t)return"";switch(e){case 0:return Object(a.a)(i.b);case 1:return Object(a.a)(i.a);case 2:case 9:return Object(a.a)(r.b);case 3:case 7:return Object(a.a)(r.a);case 5:return Object(a.a)(r.e);case 6:return Object(a.a)(r.d);case 4:return Object(a.a)(r.f);case 10:return Object(a.a)(o.b);case 8:return Object(a.a)(r.c);default:return Object(u.a)(e)}}},1919:function(e,t,n){"use strict";var r;!function(e){e[e.None=0]="None",e[e.Images=1]="Images"}(r||(r={})),t.a=r},1995:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetNewAttachmentDataProviderCreationInfoRequest:#Exchange"},e)}},1996:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetAttachmentDataProviderCreatorRequest:#Exchange"},e)}},2405:function(e){e.exports={a:"nza",b:"oza"}},2406:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(40),o=n(245),i=n(160),a=n(65);function u(e){var t=Object(r.a)();switch(e){case 5:return t.AttachmentPolicy.GoogleDriveAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(a.f)("doc-fileProvider-gdrive");case 4:case 0:return!0;case 3:return t.AttachmentPolicy.BoxAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(a.f)("doc-fileProvider-box");case 2:return t.AttachmentPolicy.DropboxAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(a.f)("doc-fileProvider-dropbox");case 6:return t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(a.f)("doc-fileProvider-facebook");case 1:return!!Object(o.a)()||Object(a.f)("doc-filePicker-oneDriveConsumerForO365")&&t.AttachmentPolicy.OnedriveAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled;case 10:return Object(a.f)("doc-filePicker-mailMessageAttachment");case 7:case 8:case 9:return t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(a.f)("doc-fileProvider-wopiClient");default:return Object(i.a)(e)}}},2471:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i});var r=n(1510),o="file provider is not addable";function i(e){return r.a.indexOf(e)>-1}},251:function(e,t,n){"use strict";var r=function(){function e(e,t,n){this.maxParallelTasks=e,this.taskCallback=t,this.taskDelay=n,this.taskList=[],this.numberOfTasksRunning=0}return e.prototype.add=function(e){this.taskList.unshift(e),this.scheduleTask()},e.prototype.clear=function(){this.taskList.splice(0,this.taskList.length)},e.prototype.canRunMoreTasks=function(){return this.numberOfTasksRunning<this.maxParallelTasks&&this.taskList.length>0},e.prototype.scheduleTask=function(){var e=this;this.canRunMoreTasks()&&setTimeout(function(){e.tryRunTask()},this.taskDelay)},e.prototype.tryRunTask=function(){this.canRunMoreTasks()&&this.runTask()},e.prototype.onTaskComplete=function(){this.numberOfTasksRunning--,this.scheduleTask()},e.prototype.runTask=function(){var e=this,t=this.taskList.pop();this.numberOfTasksRunning++,this.taskCallback(t).then(function(){e.onTaskComplete()}).catch(function(){e.onTaskComplete()}),this.scheduleTask()},e}();n.d(t,"a",function(){return r})},2520:function(e,t,n){"use strict";var r=n(797),o=n(2);function i(e,t,n){if(!e||!t||!n)throw new Error("Key and Value parameters should not be null");return e.indexOf("?")>0?e+"&"+t+"="+n:e+"?"+t+"="+n}n.d(t,"a",function(){return a}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return c}),n.d(t,"d",function(){return s});var a=Object(o.y)()?"https://exchangelabs.live-int.com/owa":"https://outlook.office.com/owa";function u(e){var t=e?encodeURIComponent("?provider="+e):"",n=e&&6===e?"AddFacebookFileProvider.html":"AddFileProvider.html";return Object(r.m)()+"/mail/"+n+t}function c(e){var t=Object(r.m)()+"/mail/AddFileProvider.html",n=encodeURIComponent("provider="+e+"&url="+t);return a+"/ADPRedirect.aspx?"+n}function s(e,t,n,r,o,a){return function(){var e=function(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),t=e.length-1,n=[],r=0;r<16;r++)n.push(e[Math.round(Math.random()*t)]);return"owa_csrf_token_"+n.join("")}(),u=i(t,"client_id",r);if(u=i(u,"redirect_uri",n),u=i(u,"response_type",o),a){var c=a(e);u=Object.keys(c).reduce(function(e,t){return i(e,t,c[t])},u)}return{authUrl:u,redirectUrl:n,csrfToken:e}}}},2569:function(e){e.exports={b:"Aza",a:"Bza"}},2649:function(e){e.exports={b:"tza",a:"uza",e:"vza",d:"wza",f:"xza",c:"yza"}},2650:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),o=n(1995);t.default=function(e,t){return void 0===e||e.__type||(e=o.default(e)),r.makeServiceRequest("GetNewAttachmentDataProviderCreationInfo",e,t)}},2651:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),o=n(1996);t.default=function(e,t){return void 0===e||e.__type||(e=o.default(e)),r.makeServiceRequest("GetAttachmentDataProviderCreator",e,t)}},298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"TokenRequest:#Exchange"},e)}},3049:function(e,t,n){"use strict";n.r(t);var r=n(4),o=Object(r.action)("getAttachmentSuggestionsAction",function(e){return{referenceItemId:e}}),i=n(740),a=Object(r.action)("storeAttachmentSuggestionsOnItemAction",function(e,t){return{referenceItemId:e,attachmentSuggestions:t}}),u=(Object(r.mutator)(a,function(e){var t=i.H.items.get(e.referenceItemId);t&&(t.AttachmentSuggestions=e.attachmentSuggestions)}),Object(r.action)("storeContextualMRUSuggestionsOnItemAction",function(e,t){return{referenceItemId:e,contextualSuggestions:t}})),c=(Object(r.mutator)(u,function(e){var t=i.H.items.get(e.referenceItemId);t&&(t.ContextualAttachmentSuggestions=e.contextualSuggestions)}),n(1484)),s=Object(r.action)("storeMRUSuggestionsAction",function(e){return{mruAttachments:e}}),l=(Object(r.mutator)(s,function(e){Object(c.a)().attachments=e.mruAttachments}),Object(r.action)("getContextualMRUSuggestionsAction",function(e){return{referenceItemId:e}})),d=Object(r.action)("getMRUSuggestionsAction"),f=Object(r.action)("getReplyWithSuggestionsAction",function(e){return{referenceItemId:e}}),h=n(65);Object(r.orchestrator)(o,function(e){Object(h.f)("mc-replyWithContextualMRU")&&e.referenceItemId?l(e.referenceItemId):(f(e.referenceItemId),d())});var p=n(0),m=n(62);function v(e){return e.Source.LastModifiedBy?e.Source.LastModifiedBy.DisplayName:e.Source.LastShared.SharedBy.DisplayName}var b=n(151),g=n(1052),O=n(467),y="application/json;charset=utf-8",j="/search/api/v1/recommendations",S="recEnableSharedClassicAttachments",_="maxMRUFiles1",I="suggestedattachments";function w(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,o,i,a,u,c,s,l,d;return Object(p.__generator)(this,function(f){switch(f.label){case 0:t=null,n=0,r="",o=null,f.label=1;case 1:return f.trys.push([1,7,8,9]),Object(b.m)("MRUQueryExecuted"),o=new b.a("QueryResponseInformation",{logVerbose:!0}),i=Object(h.f)("mc-replyWithMRUClassic"),e?o.addCustomData({endpoint:3}):o.addCustomData({endpoint:1}),[4,P()];case 2:return a=f.sent(),u=function(e,t,n){var r={};r.headers=new Headers,r.headers.set("Authorization","Bearer "+e),r.headers.set("Content-Type",y),r.method="POST";var o=Object(g.c)();o&&r.headers.append("X-AnchorMailbox",o);r.headers.set("X-Client-LocalTime",(new Date).toISOString());var i=[];n?i.push(I):t&&(i.push(S),Object(h.f)("mc-replyWithMRUCloudyLimited")&&i.push(_));i.length&&r.headers.set("X-Client-Flights",i.join(","));var a={EntityRequests:[n?{Context:{EntityId:n}}:{}],Scenario:{Name:"AttachFile"}};return r.body=JSON.stringify(a),r}(a,i,e),o.addCheckmark("Request"),[4,fetch(j,u)];case 3:return c=f.sent(),o.addCheckmark("Response"),c&&200==c.status?[4,c.text()]:[3,5];case 4:return s=f.sent(),l=JSON.parse(s),t=function(e,t){try{var n=e.EntitySets[0].ResultSets[0].Results;return n.map(function(e){return function(e,t){var n;try{var r=!!e.Source.LastShared&&!e.Source.WebUrl,o=e.Source.Author?e.Source.Author.DisplayName:"";return{Author:o,CreatedBy:o,DateAccessed:e.Source.LastAccessDateTime||(null===(n=e.Source.UserRelationship)||void 0===n?void 0:n.LastAccessDateTime),DateCreated:null,DateModified:e.Source.LastModifiedDateTime,Endpoint:t?3:r?2:1,FileExtension:e.Source.FileExtension,FileName:e.Source.FileName,FileSize:e.Source.FileSize,FileSourceType:e.ContentSource||e.Provenance,Id:r?e.Source.LastShared.AttachmentId:e.Id,ModifiedBy:v(e),ReferenceId:e.ReferenceId,SourceTitle:e.Source.SiteTitle||e.Source.LastShared.SharingSubject,Text:e.Source.Title,Title:e.Source.Title,Url:e.Source.Url}}catch(e){return m.d.info("[convertMRUAttachmentToReplyWithAttachmentSuggestion] Error accessing MRUAttachment properties: "+e.message),null}}(e,t)})}catch(e){return m.d.info("[fetchMRUSuggestions_getAttachmentsFromResponse] Error: "+e.message),[]}}(l,!!e),n=t.length,[3,6];case 5:r=c?c.status+"-"+c.statusText:"No response",f.label=6;case 6:return[3,9];case 7:return d=f.sent(),r=d.message,[3,9];case 8:return r&&m.d.info("getMRUSuggestions: Error "+r),o.addCustomData({numResults:n}),r?o.endWithError("ServerError",new Error(r)):o.end(),[2,t];case 9:return[2]}})})}function P(){return Object(p.__awaiter)(this,void 0,void 0,function(){var e,t,n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return e=Object(p.__read)(Object(O.getAccessTokenforResourceAsLazy)(window.location.origin),2),t=e[0],n=e[1],t?[3,2]:[4,n];case 1:t=r.sent(),r.label=2;case 2:return[2,t]}})})}Object(r.orchestrator)(l,function(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return t=e.referenceItemId,i.H.items.get(t)?[4,w(t)]:[3,2];case 1:n=r.sent(),u(t,n),r.label=2;case 2:return[2]}})})}),Object(r.orchestrator)(d,function(){return Object(p.__awaiter)(this,void 0,void 0,function(){var e;return Object(p.__generator)(this,function(t){switch(t.label){case 0:return[4,w(null)];case 1:return(e=t.sent())&&s(e),[2]}})})});var A=n(1081),C=n(1074),x=n(468),R=n.n(x),E=n(842),T=n.n(E),k="EntityExtraction/SubstrateSearchSuggestions",D="EntityExtraction/ReplyWithQueryCoverage",N=R()({PropertyName:k,DistinguishedPropertySetId:"Common",PropertyType:"String"}),L=R()({PropertyName:D,DistinguishedPropertySetId:"Common",PropertyType:"String"});function M(e){var t,n,r;return Object(p.__awaiter)(this,void 0,void 0,function(){var o,i,a,u,c;return Object(p.__generator)(this,function(s){switch(s.label){case 0:return null!=(o=F(e)).SubstrateSearchSuggestions||null!=o.ReplyWithQueryCoverage?[3,2]:(i=T()({BaseShape:"IdOnly",AdditionalProperties:[N,L]}),[4,Object(A.a)([e.ItemId.Id],i,null,null,null===(t=e.MailboxInfo)||void 0===t?void 0:t.requestOptions)]);case 1:a=s.sent(),Object(C.a)(a[0])&&(u=a[0],(null===(r=null===(n=u)||void 0===n?void 0:n.Items)||void 0===r?void 0:r[0])?(c=u.Items[0],o=F(c)):m.d.info("getReplyWithProperties: Unable to parse GetItem response properly.")),s.label=2;case 2:return[2,o]}})})}function F(e){var t={SubstrateSearchSuggestions:null,ReplyWithQueryCoverage:null},n=e.ExtendedProperty;if(n)for(var r=n.length,o=0;o<r;o++){var i=n[o];i.ExtendedFieldURI.PropertyName===k?t.SubstrateSearchSuggestions=i:i.ExtendedFieldURI.PropertyName===D&&(t.ReplyWithQueryCoverage=i)}return t}var U=n(112),z="/ows/search/api/v1/";function W(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,o,i=this;return Object(p.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=function(e){var t={},n=function(e){var t=[];if(null!=e.ReplyWithQueryCoverage)for(var n=JSON.parse(e.ReplyWithQueryCoverage.Value)[0],r=n.coverageCheckResults,o=Object.keys(r),i=0;i<o.length;i++){var a=o[i];r[a]||t.push(a)}return t}(e);return JSON.parse(e.SubstrateSearchSuggestions.Value)[0].requests.forEach(function(e){var r=e.InputText;if(!n.includes(r)){var o=function(e,t){for(var n,r,o=z+e,i=0;i<t.length;i++)n=t[i].Key,r=t[i].Value,o+=0==i?"?":"&",o+=n+"="+r;return o}(e.Endpoint,e.UrlParameters);t[r]=o}}),t}(e),n={},(r=Object.keys(t)).length>0?(Object(b.m)("ReplyWithQueryExecuted"),[4,Promise.all(r.map(function(e){return Object(p.__awaiter)(i,void 0,void 0,function(){var r,o;return Object(p.__generator)(this,function(i){switch(i.label){case 0:return r=n,o=e,[4,B(t[e])];case 1:return[2,r[o]=i.sent()]}})})}))]):[3,2];case 1:return a.sent(),[2,G(n)];case 2:return[3,4];case 3:return o=a.sent(),m.d.info("Failed to parse property, error: "+o.message),[3,4];case 4:return[2,null]}})})}function B(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,o,i;return Object(p.__generator)(this,function(a){switch(a.label){case 0:t=null,n=0,r="",o=null,a.label=1;case 1:return a.trys.push([1,3,4,5]),(o=new b.a("QueryResponseInformation")).addCustomData({endpoint:0}),[4,Object(U.b)(e)];case 2:return t=a.sent(),o.addCheckmark("Response"),t&&0!=t.length||(r="No response payload"),[3,5];case 3:return i=a.sent(),r=i.message,[3,5];case 4:return n=function(e){try{return e.Groups[0].Suggestions.length}catch(e){return 0}}(t),o.addCustomData({numResults:n}),r?o.endWithError("ServerError",new Error(r)):o.end(),[2,t];case 5:return[2]}})})}function G(e){try{var t={};return Object.keys(e).forEach(function(n){t[n]=e[n].Groups[0].Suggestions;for(var r=0;r<t[n].length;r++)t[n][r].Endpoint=0}),t}catch(e){return m.d.info("getSentenceToAttachmentSuggestionsMap: Failed to execute, error: "+e.message),null}}function V(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return t=null,[4,M(e)];case 1:return(n=r.sent())?[4,W(n)]:[3,3];case 2:t=r.sent(),r.label=3;case 3:return[2,t]}})})}Object(r.orchestrator)(f,function(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return Object(p.__generator)(this,function(o){switch(o.label){case 0:return t=e.referenceItemId,!(n=i.H.items.get(t))||n.AttachmentSuggestions?[3,2]:[4,V(n)];case 1:r=o.sent(),a(t,r),o.label=2;case 2:return[2]}})})});var H=n(919),X=n(1552);function q(e,t){return Object(p.__awaiter)(this,void 0,void 0,function(){var n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return n=null,Object(X.i)()!==X.c.NotLoaded?[3,2]:[4,X.k.import()];case 1:return r.sent()(function(r){n=J(Object(X.g)(),e),t(n)}),[3,3];case 2:n=J(Object(X.g)(),e),t(n),r.label=3;case 3:return[2]}})})}function J(e,t){var n=function(e){for(var t=0;t<e.length;t++)if(0==e[t].type)return e[t].model.Id;return m.d.warn("createCloudFileFromAttachmentData: Could not get OneDrive Pro provider ID. Attachment will not upload."),""}(e);return{fileType:3===t.Endpoint?H.a.ContextualSuggestion:H.a.CloudSuggestion,name:t.FileName,size:null,providerId:n,providerType:0,location:t.Url,providerEndpointUrl:null,isFolder:!1,fileId:t.Id,fileParentId:null,thumbnailUrl:null,previewUrl:null,type:null}}n.d(t,"getAttachmentSuggestionsAction",function(){return o}),n.d(t,"createCloudFileFromAttachmentData",function(){return q})},339:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),o=n(298);t.default=function(e,t){return void 0===e||e.__type||(e=o.default(e)),r.makeServiceRequest("GetAccessTokenforResource",e,t)}},762:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function o(e){var t=r(e);return t?t.replace(".",""):null}function i(e){var t;return null===(t=o(e))||void 0===t?void 0:t.substring(0,4)}var a=n(1103),u=n(5);function c(e){var t;return e>=1073741824?(e/=1073741824,t=Object(u.a)(a.b)):e>=1048576?(e/=1048576,t=Object(u.a)(a.d)):e>=1024?(e/=1024,t=Object(u.a)(a.c)):t=Object(u.a)(a.a),Object(u.b)(t,Math.round(e))}function s(e){return e&&(t=e,(n=d.exec(t))&&n.length>1&&l[n[1].toLowerCase()]);var t,n}var l={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},d=/^\s*([^;\s]*)(?:;|\s|$)/;var f=n(25),h=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],p=[".tiff",".tif"];function m(e,t,n){void 0===n&&(n=!0);var o=r(e)||s(t);return!!o&&(h.indexOf(o.toLowerCase())>=0||n&&p.indexOf(o.toLowerCase())>=0&&(Object(f.d)()||Object(f.c)()||Object(f.g)()||Object(f.f)()&&!Object(f.i)()))}var v,b=n(65),g=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function O(e){if(!Object(b.f)("doc-attachment-documentThumbnail"))return!1;var t=r(e);return!!t&&g.indexOf(t.toLowerCase())>=0}function y(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return v.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return v.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return v.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(v||(v={})),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return i}),n.d(t,"h",function(){return c}),n.d(t,"f",function(){return m}),n.d(t,"g",function(){return O}),n.d(t,"e",function(){return y}),n.d(t,"a",function(){return v})},770:function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e[e.Base64InlineImage=0]="Base64InlineImage",e[e.Cloud=1]="Cloud",e[e.Local=2]="Local",e[e.MailItem=3]="MailItem",e[e.Uri=4]="Uri",e[e.AttachmentItem=5]="AttachmentItem",e[e.CloudSuggestion=6]="CloudSuggestion",e[e.AttachmentItemSuggestion=7]="AttachmentItemSuggestion",e[e.Inline=8]="Inline",e[e.Smime=9]="Smime",e[e.FilesHub=10]="FilesHub",e[e.GroupFilesHub=11]="GroupFilesHub",e[e.MailSearchFileSuggestion=12]="MailSearchFileSuggestion",e[e.Unknown=13]="Unknown",e[e.ContextualSuggestion=14]="ContextualSuggestion",e[e.ConsumerGroupFilesHub=15]="ConsumerGroupFilesHub"}(r||(r={}))},919:function(e,t,n){"use strict";var r=n(770),o={BOX:"Box",DROPBOX:"Dropbox",FACEBOOK:"Facebook",GDRIVE:"GDrive",MAILBOX:"Mailbox",ONE_DRIVE_CONSUMER:"OneDriveConsumer",ONE_DRIVE_PRO:"OneDrivePro",RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:"WopiBox",WOPI_EGNYTE:"WopiEgnyte"};function i(e){switch(e?e.toLowerCase():null){case o.ONE_DRIVE_PRO.toLowerCase():return 0;case o.GDRIVE.toLowerCase():return 5;case o.ONE_DRIVE_CONSUMER.toLowerCase():return 1;case o.DROPBOX.toLowerCase():return 2;case o.BOX.toLowerCase():return 3;case o.WOPI_BOX.toLowerCase():return 7;case o.WOPI_EGNYTE.toLowerCase():return 8;case o.MAILBOX.toLowerCase():return 4;case o.FACEBOOK.toLowerCase():return 6;default:return null}}function a(e){return null==e?null:{attachmentItemId:e.Id,name:e.Name,size:e.Size,fileType:r.a.AttachmentItem,type:"ItemIdAttachment:#Exchange"}}function u(e){return null==e?null:{fileType:r.a.Cloud,name:e.Name,size:e.Size,providerId:e.AttachmentProviderId,providerType:e.ProviderType,location:e.Location,providerEndpointUrl:e.ProviderEndpointUrl,isFolder:1===e.Type,fileId:e.Id,fileParentId:e.ParentId,thumbnailUrl:e.Thumbnail?e.Thumbnail.Url:"",previewUrl:e.Preview?e.Preview.Url:"",type:e.MimeType}}function c(e){if(!e)return null;for(var t=[],n=0;n<e.length;n++){var o=e[n],i={fileType:r.a.Local,name:o.name,size:o.size,type:o.type,fileObject:o};t.push(i)}return t}function s(e,t,n){var o=[],i={fileType:r.a.MailItem,name:e,size:n||0,mimeContent:t};return o.push(i),o}var l=n(62);function d(e,t,n){var o;if(e.length!=t.length)return l.d.error("The sizes of subjects and latestItemIds are different"),null;for(var i=[],a=0;a<e.length;a++){var u={fileType:r.a.MailItem,name:e[a],size:(null===(o=n)||void 0===o?void 0:o[a])||0,itemId:t[a]};i.push(u)}return i}var f=n(762);function h(e){return e.map(function(e){return{fileType:r.a.Uri,name:e.name,type:Object(f.b)(e.url),size:0,uri:e.url}})}n.d(t,"b",function(){return i}),n.d(t,"e",function(){return c}),n.d(t,"g",function(){return d}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return u}),n.d(t,"h",function(){return h}),n.d(t,"f",function(){return s}),n.d(t,"a",function(){return r.a})}},0,[589,4,12,21,243,0,1,2,578,189,565,110]]);
//# sourceMappingURL=owa.AttachmentSuggestions.js.map
self.scriptsLoaded['owa.AttachmentSuggestions.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.AttachmentSuggestions.js'] = (new Date()).getTime();